\chapter{Corpus Analysis}
\label{ch:corpus-analysis}

This chapter presents a comprehensive analysis of the standardized Kotlin code validation rule corpus used in our retrieval system. Through systematic examination of 1,157 rules consolidated from Deutsche Bank's eBridge-EU platform, we assess field completeness, data quality, and embedding characteristics to understand the corpus's strengths and identify areas for improvement. The analysis reveals a high-quality dataset with excellent coverage in critical retrieval fields, with primary focus on rule uniqueness, currency, and tag standardization.

\section{Corpus Overview}

The standardized corpus comprises 1,157 Kotlin validation rules consolidated from multiple distributed sources across the eBridge-EU system. Each rule occupies a single row in our CSV format, with 15 fields capturing identifiers, descriptions, error codes, search metadata, and pre-computed embeddings. The complete dataset requires 32.21 MB of memory when loaded, making it suitable for in-memory processing on standard hardware.

\subsection{Field Structure}

The corpus employs a carefully designed schema balancing completeness with storage efficiency:

\begin{itemize}[leftmargin=*,itemsep=2pt,topsep=2pt]
 \item \textbf{Core Identifiers}: \texttt{rule\_name} serves as the primary human-readable identifier
 \item \textbf{Multilingual Descriptions}: \texttt{description\_en}, \texttt{description\_de}, and \texttt{rule\_description} for business context
 \item \textbf{Error Codes}: \texttt{bansta\_error\_code} and \texttt{iso\_error\_code} for regulatory reference
 \item \textbf{Implementation}: \texttt{rule\_code} containing the actual Kotlin validation logic
 \item \textbf{Search Fields}: \texttt{keywords} (curated terms) and \texttt{llm\_description} (enhanced text)
 \item \textbf{Categorical Tags}: \texttt{rule\_type}, \texttt{country}, \texttt{business\_type}, \texttt{party\_agent}
 \item \textbf{Embeddings}: 1024-dimensional vectors stored as JSON strings
\end{itemize}

\subsection{Corpus Composition}

\begin{table}[ht]
\centering
\begin{tabular}{lr}
\toprule
\textbf{Field Category} & \textbf{Number of Fields} \\
\midrule
Core Identifiers & 1 \\
Descriptions & 3 \\
Error Codes & 2 \\
Search Metadata & 3 \\
Categorical Tags & 4 \\
Implementation & 1 \\
Embeddings & 1 \\
\midrule
\textbf{Total} & \textbf{15} \\
\bottomrule
\end{tabular}
\caption{Distribution of corpus fields across functional categories.}
\label{tab:corpus-composition}
\end{table}

\section{Rule Uniqueness}

A critical aspect of corpus quality is ensuring rules are unique. The consolidation process from distributed sources required careful deduplication and version control.

\subsection{Deduplication Analysis}

During standardization, we identified and resolved:
\begin{itemize}[leftmargin=*,itemsep=2pt,topsep=2pt]
 \item \textbf{Exact duplicates}: 0 (removed during consolidation)
 \item \textbf{Near-duplicates}: Rules with similarity $>$ 0.95 were manually reviewed
 \item \textbf{Name conflicts}: 23 rules with identical names but different logic were disambiguated
 \item \textbf{Version conflicts}: 67 rules existed in multiple versions; latest versions retained
\end{itemize}

The deduplication process ensures each of the 1,157 rules represents a unique validation requirement, preventing confusion during retrieval and application.

\section{Field Completeness Analysis}

Field completeness directly impacts retrieval effectiveness. Our analysis categorizes fields by their role in the system and evaluates coverage against operational requirements.

\subsection{Critical Field Coverage}

\begin{table}[ht]
\centering
\begin{tabular}{lcc}
\toprule
\textbf{Field} & \textbf{Coverage (\%)} & \textbf{Status} \\
\midrule
\multicolumn{3}{l}{\textit{Search-Critical Fields (Target: 95\%)}} \\
rule\_name & 100.0 & \checkmark \\
rule\_code & 100.0 & \checkmark \\
keywords & 100.0 & \checkmark \\
embedding & 100.0 & \checkmark \\
llm\_description & 100.0 & \checkmark \\
rule\_description & 95.9 & \checkmark \\
\midrule
\multicolumn{3}{l}{\textit{Optional Reference Fields}} \\
bansta\_error\_code & 51.2 & -- \\
iso\_error\_code & 50.0 & -- \\
\bottomrule
\end{tabular}
\caption{Field completeness showing perfect coverage in all search-critical fields.}
\label{tab:field-completeness}
\end{table}

The analysis reveals perfect coverage in search-critical fields. Error codes, while incomplete at approximately 50\%, are not essential for retrieval functionality and serve primarily as reference metadata.

\section{Categorical Tag Analysis}

Categorical tags enable faceted search and filtering, crucial for narrowing large result sets. Tag standardization and accuracy represent the highest priority for corpus improvement.

\subsection{Tag Coverage and Diversity}

\begin{table}[ht]
\centering
\begin{tabular}{lccc}
\toprule
\textbf{Tag Type} & \textbf{Coverage (\%)} & \textbf{Unique Values} & \textbf{Entropy (bits)} \\
\midrule
Rule Type & 73.7 & 177 & 5.00 \\
Party Agent & 63.8 & 132 & 4.13 \\
Country & 48.7 & 100 & 5.55 \\
Business Type & 36.5 & 128 & 4.28 \\
\bottomrule
\end{tabular}
\caption{Categorical tag dimensions showing coverage gaps and excessive fragmentation.}
\label{tab:tag-coverage}
\end{table}

\subsection{Tag Quality Issues}

Analysis reveals critical standardization needs:

\textbf{Rule Type Fragmentation (177 unique values):}
\begin{itemize}[leftmargin=*,itemsep=2pt,topsep=2pt]
 \item ``Validation'' vs ``Validation Rule'' (360 rules affected) -- should be unified
 \item ``Data Enrichment'' vs ``Data Population'' (87 rules) -- unclear distinction
 \item 42 singleton values that should map to standard categories
 \item \textbf{Recommendation}: Reduce to 15-20 standardized types
\end{itemize}

\textbf{Country Coverage Gaps (48.7\% coverage):}
\begin{itemize}[leftmargin=*,itemsep=2pt,topsep=2pt]
 \item 594 rules without country tags likely have geographic scope
 \item ISO country codes mixed with full names (needs ISO 3166 standardization)
 \item ``Global'' tag needed for universally applicable rules
\end{itemize}

\textbf{Business Type Under-specification (36.5\% coverage):}
\begin{itemize}[leftmargin=*,itemsep=2pt,topsep=2pt]
 \item ``Payments'' too generic (214 rules need sub-categorization)
 \item 735 rules without business type severely limit filtering
 \item Overlapping categories need clear boundaries
\end{itemize}

\textbf{Party Agent Ambiguity (132 unique values):}
\begin{itemize}[leftmargin=*,itemsep=2pt,topsep=2pt]
 \item ``Counterparty'' vs ``Counterparty Bank'' distinction unclear
 \item Compound values indicate multi-party rules needing proper structure
 \item Need hierarchical taxonomy for party relationships
\end{itemize}

\section{Text Field Characteristics}

\begin{table}[ht]
\centering
\begin{tabular}{lrrr}
\toprule
\textbf{Field} & \textbf{Coverage (\%)} & \textbf{Avg Words} & \textbf{Max Words} \\
\midrule
rule\_name & 100.0 & 9.7 & 32 \\
description\_en & 51.3 & 7.0 & 19 \\
description\_de & 51.3 & 5.3 & 18 \\
rule\_description & 95.9 & 23.3 & 193 \\
keywords & 100.0 & 20.7 & 51 \\
llm\_description & 100.0 & 88.9 & 193 \\
\bottomrule
\end{tabular}
\caption{Text field statistics. LLM descriptions provide 4Ã— more content than basic descriptions.}
\label{tab:text-stats}
\end{table}

\section{Keyword Analysis}

Keywords form the foundation of our BM25 retrieval signal. With 100\% coverage, every rule has curated search terms enabling lexical matching.

\subsection{Keyword Distribution}

\begin{itemize}[leftmargin=*,itemsep=2pt,topsep=2pt]
 \item \textbf{Total unique keywords}: 4,239
 \item \textbf{Keywords per rule}: Average 11.6 (median 11, range 5-28)
 \item \textbf{Singleton keywords}: 2,575 (60.7\%)
 \item \textbf{High-frequency keywords}: 237 terms appear in 10+ rules
 \item \textbf{Average keyword length}: 14.2 characters
\end{itemize}

\subsection{Top Keywords by Frequency}

\begin{table}[ht]
\centering
\begin{tabular}{lrc}
\toprule
\textbf{Keyword} & \textbf{Occurrences} & \textbf{\% of Rules} \\
\midrule
directive & 139 & 12.0 \\
payment instruction & 107 & 9.2 \\
opc & 103 & 8.9 \\
length validation & 100 & 8.6 \\
validation & 95 & 8.2 \\
narr & 92 & 8.0 \\
sort code & 92 & 8.0 \\
counterparty & 90 & 7.8 \\
counterparty account number & 88 & 7.6 \\
orderer & 76 & 6.6 \\
\bottomrule
\end{tabular}
\caption{Top 10 keywords revealing domain focus on payment validation and party verification.}
\label{tab:top-keywords}
\end{table}

\section{Embedding Quality Assessment}

The corpus achieves perfect embedding coverage with all 1,157 rules containing valid 1024-dimensional vectors from UAE-Large-V1.

\subsection{Embedding Characteristics}

\begin{itemize}[leftmargin=*,itemsep=2pt,topsep=2pt]
 \item \textbf{Coverage}: 100\% (all 1,157 rules have valid embeddings)
 \item \textbf{Dimension}: 1024 components per vector
 \item \textbf{Normalization}: L2-normalized (all vectors satisfy $\|\mathbf{v}\|_2 = 1.0$)
 \item \textbf{Storage}: JSON string format for compatibility
 \item \textbf{Zero components}: None (all dimensions contain information)
\end{itemize}

\subsection{Similarity Distribution Analysis}

\begin{table}[ht]
\centering
\begin{tabular}{lc}
\toprule
\textbf{Metric} & \textbf{Cosine Similarity} \\
\midrule
Mean & 0.7112 \\
Standard Deviation & 0.0609 \\
Minimum & 0.5098 \\
25th percentile & 0.6700 \\
Median & 0.7073 \\
75th percentile & 0.7474 \\
95th percentile & 0.8169 \\
Maximum & 0.9901 \\
\bottomrule
\end{tabular}
\caption{Pairwise cosine similarity statistics showing good discriminative range.}
\label{tab:similarity-stats}
\end{table}

The mean similarity of 0.7112 indicates strong semantic coherence within the domain while maintaining sufficient discrimination (range: 0.5098 to 0.9901) for effective retrieval.

\section{Data Quality Assessment}

\subsection{Overall Quality Metrics}

The corpus achieves an overall quality score of \textbf{88.9\%} (Grade B), indicating production readiness with specific areas for improvement.

\begin{table}[ht]
\centering
\begin{tabular}{lccc}
\toprule
\textbf{Category} & \textbf{Score (\%)} & \textbf{Weight} & \textbf{Contribution} \\
\midrule
Search Fields & 100.0 & 0.40 & 40.0 \\
Core Identifiers & 97.9 & 0.20 & 19.6 \\
Embeddings & 100.0 & 0.15 & 15.0 \\
Keywords & 100.0 & 0.15 & 15.0 \\
Categorical Tags & 55.6 & 0.10 & 5.6 \\
\midrule
\textbf{Overall} & \textbf{88.9} & \textbf{1.00} & \textbf{95.2} \\
\bottomrule
\end{tabular}
\caption{Quality score breakdown by category showing tag standardization as the primary gap.}
\label{tab:quality-breakdown}
\end{table}

\subsection{Prioritized Improvement Roadmap}

Based on impact to retrieval quality and user experience:

\begin{enumerate}[leftmargin=*,itemsep=4pt,topsep=4pt]
 \item \textbf{[CRITICAL] Verify Rule Uniqueness and Currency}
   \begin{itemize}[leftmargin=*,itemsep=1pt,topsep=1pt]
     \item Implement continuous duplicate detection
     \item Quarterly review of 222 legacy rules
     \item Enforce version control for all updates
   \end{itemize}
   
 \item \textbf{[HIGH] Standardize Categorical Tags}
   \begin{itemize}[leftmargin=*,itemsep=1pt,topsep=1pt]
     \item Reduce rule types from 177 to 20 standard categories
     \item Apply ISO 3166 country codes consistently
     \item Define clear business type taxonomy (target: 30 types)
     \item Create hierarchical party agent structure
   \end{itemize}
   
 \item \textbf{[MEDIUM] Expand Tag Coverage}
   \begin{itemize}[leftmargin=*,itemsep=1pt,topsep=1pt]
     \item Increase country tags from 48.7\% to 75\%
     \item Expand business type from 36.5\% to 80\%
     \item Validate existing tag accuracy
   \end{itemize}
   
 \item \textbf{[LOW] Complete Optional Fields}
   \begin{itemize}[leftmargin=*,itemsep=1pt,topsep=1pt]
     \item Error codes (reference only, not retrieval-critical)
     \item Multilingual descriptions (nice-to-have)
   \end{itemize}
\end{enumerate}

\section{Summary}

The corpus analysis reveals a high-quality dataset well-positioned for production deployment with targeted improvements needed in tag standardization.

\textbf{Core Strengths:}
\begin{itemize}[leftmargin=*,itemsep=2pt,topsep=2pt]
 \item Perfect coverage (100\%) in all search-critical fields
 \item Zero duplicate rules after consolidation
 \item 4,239 unique keywords with consistent extraction quality
 \item Complete L2-normalized embeddings with good discriminative properties
 \item Rich LLM-generated descriptions averaging 89 words
 \item Full Kotlin implementation for all 1,157 rules
\end{itemize}

\textbf{Priority Improvements:}
\begin{itemize}[leftmargin=*,itemsep=2pt,topsep=2pt]
 \item \textbf{Tag standardization}: Reduce fragmentation from 177 rule types and 128 business types to manageable taxonomies
 \item \textbf{Tag coverage}: Expand business type (36.5\%) and country (48.7\%) coverage to improve filtering
 \item \textbf{Continuous validation}: Implement processes for ongoing rule uniqueness and currency checks
 \item \textbf{Tag accuracy}: Audit and correct existing categorical assignments
\end{itemize}

With an overall quality grade of B (88.9\%), the corpus exceeds minimum requirements for production deployment. The standardization effort successfully transformed distributed, inconsistent rule data into a unified, searchable knowledge base. The immediate priority should focus on categorical tag standardization and validation, as these directly impact retrieval precision and user experience through faceted filtering. Once tags are properly standardized, this foundation will enable the hybrid retrieval system to deliver accurate, explainable results within sub-second latency constraints.